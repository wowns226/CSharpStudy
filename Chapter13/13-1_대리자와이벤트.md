# 대리자와 이벤트

## 대리자란?
* `대리자(delegate)`는 메소드를 대신 호출해주는 역할을 수행한다.
* 대리자는 메소드에 대한 참조이다. 대리ㅏ자에 메소드의 주소를 할당한 후 대리자를 호출하면 대리자가 메소드를 호출해준다.
* `delegate` 키워드를 사용한다.

### 대리자의 선언
```c#
한정자 delegate 반환_형식 대리자_이름(매개변수_목록);
```

* 대리자는 인스턴스가 아닌 형식(Type)이다.
* 대리자는 인스턴스 메소드를 참조할 수 있으며, 정적 메소드도 참조할 수 있다.


### 대리자를 이용하여 콜백을 구현하는 과정
1. 대리자를 선언한다.
2. 대리자의 인스턴스를 생성한다. 인스턴스를 생성할 때 대리자가 참조할 메소드를 인수로 넘긴다.
3. 대리자를 호출한다.
* [[Code]](/Code/Chapter13/Delegate.cs)

## 대리자를 사용해야 하는 경우와 이유
`값`이 아닌 `코드`자체를 매개변수로 넘기고 싶을때 사용한다.<br>
대리자는 메소드에 대한 참조이므로, 메소드를 참조할 대리자를 매개변수에 받을 수 있도록 메소드를 구현하면 된다.

* [[Code]](/Code/Chapter13/UsingCallback.cs)


## 일반화 대리자
대리자는 일반 메소드뿐 아니라 일반화 메소드도 참조할 수 있다.<br>
물론 일반화 메소드를 참조하려면 대리자도 형식 매개변수를 이용하여 선언해야 한다.<br>
위의 예제에서 선언한 Compare 대리자를 일반화하여 다음과 같이 선언할 수 있다.
```c# 
delegate int Compare<T>(T a, T b);
```
* [[Code]](/Code/Chapter13/GenericDelegate.cs)

## 대리자 체인
하나의 대리자가 여러 개의 메소드를 동시에 참조할 수 있다. (동시는 아니고 추가된 순서대로 호출한다.)
`+=`연산자를 이용하여 대리자의 인스턴스에 메소드들을 참조하게 할 수 있다.
* [[Code]]()

### 체인을 만드는 방법
1. `+`, `=`연산자를 이용해 대리자에 메소드를 추가한다.
2. `+=` 연산자를 이용해 대리자에 메소드를 추가한다.
3. Delegate.Combine()함수를 이용해 대리자에 메소드를 추가한다.

### 체인을 해제하는 방법
1. `-=` 연산자를 이용해 대리자에 메소드를 제거한다.
2. Delegate.Remove()함수를 이용해 대리자에 메소드를 제거한다.

## 익명 메소드
메소드는 `한정자`없이, `반환 형식` 없이, `매개변수` 없이 선언할 수 있다.
```c#
void MyMethod() 
{
    //
}
```
익명 메소드는 그렇지 않다.<br>
익명 메소드란, 이름이 없는 메소드이다.<br>
```c#
대리자_인스턴스 = delegate (매개변수_목록)
                {
                    // 실행하고자 하는 코드
                }
```
익명 메소드는 자신을 참조할 대리자의 형식과 동일한 형식으로 선언되어야 한다.<br>
또한, 대리자에서 선언된 매개변수의 개수와 익명 메소드의 매개변수의 개수와 같아야한다.
메소드를 두 번 다시 사용할 일이 없다면 익명 메소드를 사용하면 된다.
* [[Code]](/Code/Chapter13/AnnoymousMethod.cs)

## 대리자와 이벤트

## 이벤트
이벤트의 동작 원리는 대리자와 거의 비슷하다.<br>
이벤트는 대리자를 `event` 한정자로 수식해서 만든다.

### 이벤트를 선언하고 사용하는 절차
1. 대리자를 선언한다.
2. 클래스 내에 선언한 대리자의 인스턴스를 event 한정자로 수식해서 선언한다.
3. 이벤트 핸들러를 작성한다. 이벤트 핸들러는 `1`에서 선언한 대리자와 일치하는 메소드면 된다.
4. 클래스의 인스턴스를 생성하고 이 객체의 이벤트에 `3`의 이벤트 핸들러를 등록한다.
5. 이벤트가 발생하면 이벤트 핸들러가 호출된다.
* [[Code]](/Code/Chapter13/EventTest.cs)

### 대리자와 이벤트
이벤트가 대리자와 가장 큰 다른 점은 `이벤트를 외부에서 직접 사용할 수 없다`이다.<br>
이벤트는 public 한정자로 선언되어 있어도 외부에서는 호출이 불가능하다.<br>
하지만 대리자는 public이나 internal로 수식되어 있으면 외부에서 호출이 가능하다.